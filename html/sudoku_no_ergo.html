<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Ergo-no - 25x25 Sudoku Game" />
  <title>Ergo-no - 25x25 Sudoku</title>
  <link rel="stylesheet" href="../css/style.css" />
</head>
<body>
  <div id="header"></div>
  <main>
    <div id="loading-bar" style="width:100%;height:8px;background:#eee;position:relative;display:none;margin-bottom:1em;">
      <div id="loading-progress" style="height:100%;width:0;background:#e74c3c;transition:width 0.3s;"></div>
    </div>
    <div id="sudoku-controls" style="display:none;"></div>
    <div id="sudoku-board"></div>
    <div style="margin-top:1em;">
      <button id="check-sudoku">Check</button>
      <button id="solve-sudoku">Solve</button>
      <button id="reset-sudoku">Reset</button>
      <button id="new-sudoku">New</button>
    </div>
  </main>
  <div id="footer"></div>
  <script src="../js/sudoku.js"></script>
  <script src="../js/script.js"></script>
  <script>
    window.nonErgoMode = true;
    function showLoadingBar() {
      var bar = document.getElementById('loading-bar');
      var prog = document.getElementById('loading-progress');
      bar.style.display = 'block';
      prog.style.width = '0';
      setTimeout(function(){ prog.style.width = '80%'; }, 50);
    }
    function hideLoadingBar() {
      var bar = document.getElementById('loading-bar');
      var prog = document.getElementById('loading-progress');
      prog.style.width = '100%';
      setTimeout(function(){ bar.style.display = 'none'; prog.style.width = '0'; }, 400);
    }
    function getQuerySize() {
      var m = window.location.search.match(/size=(\d+)/);
      return m ? parseInt(m[1]) : 25;
    }
    if (typeof initSudokuGame === 'function') {
      document.addEventListener('DOMContentLoaded', function() {
        var controls = document.getElementById('sudoku-controls');
        controls.innerHTML = '';
        var sizeSelect = document.createElement('select');
        sizeSelect.id = 'sudoku-size';
        var opt = document.createElement('option');
        var size = getQuerySize();
        opt.value = size;
        opt.textContent = size + ' x ' + size;
        opt.selected = true;
        sizeSelect.appendChild(opt);
        controls.appendChild(sizeSelect);
        controls.style.display = 'none';
        // Patch initSudokuGame to show/hide loading bar for large boards
        var origInit = window.initSudokuGame;
        window.initSudokuGame = function() {
          if (parseInt(sizeSelect.value) >= 16) showLoadingBar();
          setTimeout(function() {
            origInit();
            if (parseInt(sizeSelect.value) >= 16) hideLoadingBar();
          }, parseInt(sizeSelect.value) >= 16 ? 100 : 0);
        };
        initSudokuGame();
      });
    }
  </script>
  <script>
    // Load header
    fetch('header.html')
      .then(response => response.text())
      .then(html => {
        document.getElementById('header').innerHTML = html;
      });

    // Load footer
    fetch('footer.html')
      .then(response => response.text())
      .then(html => {
        document.getElementById('footer').innerHTML = html;
      });
  </script>
</body>
</html>